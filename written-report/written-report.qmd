---
title: "Draft"
subtitle: "STA 210 - Project"
author: "Ginger and Stats - Aimi Wen, Rakshita Ramakrishna, Nathan Nguyen"
format: pdf
editor: visual
---

```{r}
#| label: load-pkg-data
#| warning: false
library(tidyverse)
library(tidymodels)
library(tidytext)
library(patchwork)
library(stringr)

chocolate <- read_csv("../data/chocolate.csv")
```

# Exploratory Data Analysis
## Data description

## Analysis approach

## Shape of Ratings (already done)

...

## Cocoa Percent (Aimi)

```{r}
#| label: cocoa-percent

chocolate$cocoa_percent <- as.numeric(gsub('[,%]', '', chocolate$cocoa_percent))

chocolate$rating <- as.character(chocolate$rating) 

ggplot(data= chocolate, aes(x= cocoa_percent)) + geom_histogram() 

ggplot(data= chocolate, aes(x= cocoa_percent, y= rating)) + geom_boxplot()

chocolate$rating <- as.numeric(chocolate$rating) 
```

## Ingredients (Nathan)

```{r}
chocolate <- chocolate %>%
  mutate(lecithin = case_when(
    grepl("L", ingredients) ~ 1,
    T ~ 0
  ),
  vanilla = case_when(
    grepl("V", ingredients) ~ 1,
    T ~ 0
  ),
  cocoa = case_when(
    grepl("C", ingredients) ~ 1,
    T ~ 0
  ),
  salt = case_when(
    grepl("Sa", ingredients) ~ 1,
    T ~ 0
  ),
  
  lecithin = as.factor(lecithin),
  vanilla = as.factor(vanilla),
  cocoa = as.factor(cocoa),
  salt = as.factor(salt)
  )
```

```{r}
pL <- ggplot(chocolate, aes(lecithin)) +
  geom_bar()
pV <- ggplot(chocolate, aes(vanilla)) +
  geom_bar()
pC <- ggplot(chocolate, aes(cocoa)) +
  geom_bar()
pSa <- ggplot(chocolate, aes(salt)) +
  geom_bar()

(pL + pV)/(pC + pSa)

```

```{r}
chocolate <- chocolate %>%
  mutate(
    num_ingres = if_else(is.na(ingredients), "0", str_sub(ingredients, 1, 1))
  )
```


```{r}
chocolate %>%
  drop_na(
    ingredients
  ) %>%
  count()
```
```{r}
ggplot(chocolate, aes(num_ingres))+
  geom_bar()+
  labs(
    title = "Distribution of number of ingredients",
    x = "Number of ingredients"
  )
```

## Most Memorable Characteristic (Aimi)

```{r}
#| label: memorable-char

tidy_chocolate<- chocolate %>% 
  unnest_tokens(word, most_memorable_characteristics)

tidy_chocolate %>% 
  group_by(word) %>% 
  summarize( n= n(), 
             rating= mean(rating) ) %>%
  ggplot(aes(n, rating)) + 
  geom_hline(yintercept= mean(chocolate$rating)) + 
  geom_jitter(color= "blue", alpha= 0.5) + 
  geom_text(aes(label= word),
            check_overlap= TRUE, 
            vjust= "top", 
            hjust= "left") +
  scale_x_log10() 
```

## Country Bean of Origin vs Specific Bean Origin (Rakshita)

## Company Location (Rakshita)

## Review Date (Nathan)

```{r}
ggplot(chocolate, aes(review_date))+
  geom_bar()
```

```{r}
#| label: review date statistics

# statistics of review dates

chocolate %>%
  summarise(mean = mean(review_date),
            median = median(review_date),
            sd = sd(review_date))
```
```{r}
#review date vs cocoa_percent and ratings

chocolate <- chocolate %>%
  mutate(
    date_fct = as.factor(review_date)
  )

ggplot(chocolate, aes(date_fct, cocoa_percent))+
  geom_boxplot()+
  coord_flip()

ggplot(chocolate, aes(date_fct, fill = as.factor(rating)))+
  geom_bar(position = "fill")+
  coord_flip()+
  scale_fill_viridis_d()
```

# Data

The data dictionary can be found [here](ADD%20LINK!!!).
